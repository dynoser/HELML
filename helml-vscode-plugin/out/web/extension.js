(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{HELMLfromJSON:()=>N,HELMLtoJSON:()=>p,HELMLtoPHP:()=>h,HELMLtoPython:()=>E,activate:()=>f,deactivate:()=>d,decodeJSONtry:()=>g,removeJSONcomments:()=>b});const n=require("vscode");class r{static encode(e,t=!1){let n=[];e=r.iterablize(e);let o=t?"~":"\n",i=t?".":":",s=t?"_":" ",l=Array.isArray(e);if(!l&&r.ENABLE_BONES){const t=Object.keys(e),n=Array.from({length:t.length},((e,t)=>String(t)));l=t.every(((e,t)=>e===n[t]))}return r._encode(e,n,0,i,s,l),t&&1==n.length&&n.push(""),n.join(o)}static _encode(e,t,n=0,o=":",i=" ",s=!1){const l=null===r.CUSTOM_VALUE_ENCODER?r.valueEncoder:r.CUSTOM_VALUE_ENCODER;for(let a in e){let c=e[a];if(s&&r.ENABLE_BONES)a="--";else if(!s){let e=a.charAt(0),t=a.charAt(a.length-1);-1===a.indexOf(o)&&-1===a.indexOf("~")&&"#"!==e&&e!==i&&" "!==e&&""!==e||(e="-"),"-"!==e&&t!==i&&" "!==t&&/^[ -~]+$/.test(a)||(a="-"+r.base64Uencode(a))}let u=o.repeat(n);r.ENABLE_SPC_IDENT&&" "===i&&(u=i.repeat(n)+u);let f=Array.isArray(c);null===c||!f&&"object"!=typeof c?(c=l(c,i),t.push(u+a+o+c)):(r.ENABLE_KEY_UPLINES&&" "===i&&t.push(""),t.push(u+(f?a+o:a)),c=r.iterablize(c),r._encode(c,t,n+1,o,i,f),r.ENABLE_HASHSYMBOLS&&" "===i&&t.push(" ".repeat(n)+"#"))}}static decode(e,t=[0]){const n=null===r.CUSTOM_VALUE_DECODER?r.valueDecoder:r.CUSTOM_VALUE_DECODER;let o="0",i=o,s=new Set(["0"]);t.forEach(((e,n)=>{"number"==typeof e&&(t[n]=e.toString())}));let l=":",a=" ",c="\n";for(c of["\n","~","\r"])if(-1!==e.indexOf(c)){"~"===c&&(l=".",a="_");break}let u=e.split(c),f={},d=[],E=-1;for(let e of u){if(e=e.trim(),!e.length||"#"===e.charAt(0))continue;let c=0;for(;e.charAt(c)===l;)c++;c&&(e=e.substring(c));const u=e.indexOf(l);let h=-1===u?e:e.substring(0,u),p=-1===u?null:e.substring(u+1);(E<0||E>c)&&(E=c);let b=d.length-(c-E);if(b>0){for(;d.length&&b--;)d.pop();i=o}let g=f;for(let e of d)g=g[e];if("-"===h.charAt(0))if("--"===h||"---"===h)h="object"==typeof g?String(Object.keys(g).length):"0";else{if(h.startsWith("-+")){null!==p&&(p=p.trim()),"-++"===h?(o=p||"0",i=o):"-+"===h&&(i=null==p?Number.isInteger(parseInt(i))?String(i+1):o:""===p?o:p),s.add(i);continue}{let e=r.base64Udecode(h.substring(1));null!==e&&(h=e)}}null===p||""===p?(g[h]=""===p?[]:{},d.push(h),i=o):t.includes(i)&&(g[h]=n(p,a))}return s.size>1&&(f._layers=Array.from(s)),f}static valueEncoder(e,t=" "){if("string"==typeof e){let n;return n="_"===t?/^[ -~]+$/:/^[\u0020-\u007E\u00A0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]+$/,-1===e.indexOf("~")&&n.test(e)?!e.length||t===e[0]||t===e.slice(-1)||/\s/.test(e.slice(-1))?"'"+e+"'":t+e:"-"+r.base64Uencode(e)}{const n=typeof e;switch(n){case"boolean":e=e?"T":"F";break;case"undefined":e="U";break;case"number":if(e===1/0)e="INF";else if(e===-1/0)e="NIF";else if(Number.isNaN(e))e="NAN";else if("_"===t&&!Number.isInteger(e))return"-"+r.base64Uencode(String(e));case"bigint":break;case"object":if(null===e){e="N";break}default:throw new Error(`Cannot encode value of type ${n}`)}}return t+t+e}static valueDecoder(e,t=" "){const n=e.charAt(0);if(t===n){if(e.substring(0,2)!==t+t)return e.slice(1);let n=e.slice(2);return n in r.SPEC_TYPE_VALUES?r.SPEC_TYPE_VALUES[n]:/^-?\d+(.\d+)?$/.test(n)?-1!==n.indexOf(".")?parseFloat(n):parseInt(n,10):"function"==typeof r.CUSTOM_FORMAT_DECODER?r.CUSTOM_FORMAT_DECODER(e,t):n}if('"'===n||"'"===n)return e=e.slice(1,-1),'"'===n?r.stripcslashes(e):e;if("-"===n)e=e.slice(1);else if("function"==typeof r.CUSTOM_FORMAT_DECODER)return r.CUSTOM_FORMAT_DECODER(e,t);return r.base64Udecode(e)}static base64Uencode(e){let t;if("undefined"!=typeof Buffer)t=Buffer.from(e,"binary").toString("base64");else{if("undefined"==typeof window||"function"!=typeof window.btoa)throw new Error("Not found me base64-encoder");t=window.btoa(e)}return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static base64Udecode(e){for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";try{let t;if("undefined"!=typeof Buffer)t=Buffer.from(e,"base64").toString("binary");else{if("undefined"==typeof window||"function"!=typeof window.atob)throw new Error("Not found base64-decoder");t=window.atob(e)}return t}catch(e){return null}}static iterablize(e){return"function"!=typeof e[Symbol.iterator]?(e[Symbol.iterator]=function*(){const e=[];for(const t in this)this.hasOwnProperty(t)&&e.push([t,this[t]]);yield*e},e):e instanceof Set||e instanceof Map?Array.from(e.values()):e}static stripcslashes(e){const t={"\\n":"\n","\\t":"\t","\\r":"\r","\\b":"\b","\\f":"\f","\\v":"\v","\\0":"\0","\\\\":"\\"};return e.replace(/\\(n|t|r|b|f|v|0|\\)/g,(e=>t[e]))}}r.ENABLE_BONES=!0,r.ENABLE_SPC_IDENT=!0,r.ENABLE_KEY_UPLINES=!0,r.ENABLE_HASHSYMBOLS=!0,r.CUSTOM_FORMAT_DECODER=null,r.CUSTOM_VALUE_DECODER=null,r.CUSTOM_VALUE_ENCODER=null,r.SPEC_TYPE_VALUES={N:null,U:void 0,T:!0,F:!1,NAN:NaN,INF:1/0,NIF:-1/0};const o=r;class i{static toPHParr(e,t){"number"==typeof t?(t>10&&(t=10),t=" ".repeat(t)):t=t.slice(0,10);let n=function(e){return t?e.split("\n").map((function(e){return t+e})).join("\n"):e},r=typeof e;switch(!0){case"number"===r:if(Number.isNaN(e))return"NAN";if(e===1/0)return"INF";if(e===-1/0)return"-INF";case"string"===r:case"boolean"===r:case null===e:return JSON.stringify(e);case Array.isArray(e):return(t?"[\n":"[")+e.map((function(e){return i.toPHParr(e,t)})).map(n).join(t?",\n":",")+(t?"\n]":"]");case"object"===r&&!Array.isArray(e):let s=[];for(var o in e)s.push(JSON.stringify(o)+(t?" => ":"=>")+i.toPHParr(e[o],t));return(t?"[\n":"[")+s.map(n).join(t?",\n":",")+(t?"\n]":"]");default:throw new Error("parse error")}}}class s{static toPythonArr(e,t=0){const n=" ".repeat(2*t);if(Array.isArray(e)){const r=e.map((e=>n+"  "+this.toPythonArr(e,t+1))).join(",\n");return r?"[\n"+r+"\n"+n+"]":"[]"}if("object"==typeof e&&null!==e){const r=Object.entries(e).map((([e,r])=>`${n}  ${JSON.stringify(e)}: ${this.toPythonArr(r,t+1)}`)).join(",\n");return r?"{\n"+r+"\n"+n+"}":"{}"}return Number.isNaN(e)?'float("nan")':e===1/0?'float("inf")':e===-1/0?'float("-inf")':null===e?"None":!0===e?"True":!1===e?"False":JSON.stringify(e)}}var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function l(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((r=r.apply(e,t||[])).next())}))};let a=["0"];function c(e=null){const t=n.workspace.getConfiguration("helml"),r=t.get("enableident"),i=t.get("enablebones"),s=t.get("enableuplines"),l=t.get("enablehashsym");if(void 0!==r&&r!==o.ENABLE_SPC_IDENT&&(t.update("enableident",r,!0),o.ENABLE_SPC_IDENT=r),void 0!==i&&i!==o.ENABLE_BONES&&(t.update("enablebones",i,!0),o.ENABLE_BONES=i),void 0!==s&&s!==o.ENABLE_KEY_UPLINES&&(t.update("enableuplines",s,!0),o.ENABLE_KEY_UPLINES=s),void 0!==l&&s!==o.ENABLE_HASHSYMBOLS&&(t.update("enablehashsym",l,!0),o.ENABLE_HASHSYMBOLS=l),null===e||e.affectsConfiguration("helml.getlayers")){const e=t.get("getlayers");e&&(a=[],e.split(",").forEach((e=>a.push(e.trim()))))}}function u(e){return()=>{const t=n.window.activeTextEditor;if(!t)return;const{document:r,selection:o}=t,i=r.getText(o);if(!i)return void n.window.showWarningMessage("No text selected!");const s=e(i);s&&t.edit((e=>{e.replace(o,s)}))}}function f(e){const t=n.commands.registerCommand("helml.toJSON",u(p)),r=n.commands.registerCommand("helml.fromJSON",u(N)),o=n.commands.registerCommand("helml.toPHP",u(h)),i=n.commands.registerCommand("helml.toPython",u(E)),s=n.commands.registerCommand("helml.fromJSONDoc",(()=>l(this,void 0,void 0,(function*(){const e=n.window.activeTextEditor;if(!e)return;const{document:t,selection:r}=e;let o,i=t.getText(r),s=!i;t.isDirty,i?i===t.getText()&&(s=!0):i=t.getText();const l=N(i);l&&(t.fileName,o=yield n.workspace.openTextDocument({content:l,language:"helml"})),n.window.showTextDocument(o)}))));e.subscriptions.push(t),e.subscriptions.push(s),e.subscriptions.push(r),e.subscriptions.push(o),e.subscriptions.push(i)}function d(){}function E(e){try{const t=o.decode(e,a);return s.toPythonArr(t,1)}catch(e){return console.error("Error: failed to encode HELML to Python code",e),n.window.showErrorMessage("Failed to encode HELML to Python code"),null}}function h(e){try{const t=o.decode(e,a);return i.toPHParr(t,1)}catch(e){return console.error("Error: failed to encode HELML to PHP code",e),n.window.showErrorMessage("Failed to encode HELML to PHP code"),null}}function p(e){try{const t=o.decode(e,a);return JSON.stringify(t,null,"\t")}catch(e){return console.error("Error: failed to encode HELML to JSON",e),n.window.showErrorMessage("Failed to encode HELML to JSON"),null}}function b(e){return e.replace(/^(\s*)\/\/.*$/gm,"").replace(/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//g,"")}function g(e){try{return JSON.parse(e)}catch(e){return null}}function N(e){try{(e=e.trim()).startsWith('"')&&((e="{"+e).endsWith(",")&&(e=e.slice(0,-1)),e+="}");let t=g(e);return null===t&&(e=b(e),t=JSON.parse(e)),o.encode(t)}catch(e){return n.window.showErrorMessage("Failed to decode JSON to HELML!"),null}}c(),n.workspace.onDidChangeConfiguration((e=>{e.affectsConfiguration("helml")&&c(e)}));const y={provideHover(e,t){const r=e.lineAt(t).text,i=e.getWordRangeAtPosition(t),s=(e.getText(i),function(e,t){let n=null,r="key",i=" value";if(!(e=e.trim()).length||"#"===e.charAt(0))return null;let s=0;for(;":"===e.charAt(s);)s++;s&&(e=e.substring(s));const l=e.indexOf(":");let a=-1===l?e:e.substring(0,l),c=-1===l?null:e.substring(l+1);if("-"===a.charAt(0))if("--"===a)r="next",a="[NextNum]";else{if(a.startsWith("-+"))return c?"Layer: "+c:"Layer Next";{r="-b64key";let e=o.base64Udecode(a.substring(1));null===e?n="ERROR: encoded KEY contain illegal chars":/^[ -~]+$/.test(e)&&(r=`-b64key(<i>${e}</i>)`)}}if(null===n)if(null===c)n=`Create [${a}] Array`;else if(""===c)n=`Create [${a}] LIST`;else if(c.startsWith(" "))c.startsWith("  ")&&(i=" value <i>(non-string)<i>");else if("-"===c.charAt(0)){i="-b64value";let e=o.base64Udecode(c.substring(1));null===e?n="ERROR: encoded VALUE contain illegal chars":i=`-b64=${e}`}else i="UNKNOWN or USER-DEFINED VALUE";return null===n&&(n=r+":"+i),n}(r));return s?new n.Hover(s):null}};n.languages.registerHoverProvider("helml",y);var m=exports;for(var S in t)m[S]=t[S];t.__esModule&&Object.defineProperty(m,"__esModule",{value:!0})})();
//# sourceMappingURL=extension.js.map